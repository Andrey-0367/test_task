(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{558:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>o,Bj:()=>s,DD:()=>c,vc:()=>i});let r=(0,a(5710).Z0)({name:"products",initialState:{localProducts:[]},reducers:{addProduct:{reducer(e,t){e.localProducts.unshift(t.payload)},prepare(e){let t=Date.now();return{payload:{...e,id:t}}}},updateProduct(e,t){let a=e.localProducts.findIndex(e=>e.id===t.payload.id);-1!==a?e.localProducts[a]=t.payload:e.localProducts.unshift(t.payload)},deleteProduct(e,t){e.localProducts=e.localProducts.filter(e=>e.id!==t.payload)}},extraReducers:e=>{e.addMatcher(e=>e.type.includes("productsApi"),e=>e)}}),{addProduct:s,updateProduct:i,deleteProduct:c}=r.actions,o=r.reducer},1471:(e,t,a)=>{"use strict";a.d(t,{Kc:()=>c,ZN:()=>i,hi:()=>o});var r=a(404),s=a(4317);let i=(0,r.xP)({reducerPath:"productsApi",baseQuery:(0,s.cw)({baseUrl:"https://fakestoreapi.com/",prepareHeaders:e=>(e.set("Content-Type","application/json"),e)}),tagTypes:["Product"],endpoints:e=>({getProducts:e.query({query:()=>"/products",transformResponse:e=>e.map(e=>({...e,price:String(e.price),image:e.image.startsWith("http")?e.image:"https://fakestoreapi.com".concat(e.image.startsWith("/")?"":"/").concat(e.image),rating:e.rating||{rate:0,count:0}})),providesTags:e=>e?[...e.map(e=>{let{id:t}=e;return{type:"Product",id:t}}),{type:"Product",id:"LIST"}]:[{type:"Product",id:"LIST"}]}),getProductById:e.query({query:e=>"/products/".concat(e),transformResponse:e=>({...e,price:String(e.price),image:e.image.startsWith("http")?e.image:"https://fakestoreapi.com".concat(e.image.startsWith("/")?"":"/").concat(e.image),rating:e.rating||{rate:0,count:0}}),providesTags:(e,t,a)=>[{type:"Product",id:a}]}),addProduct:e.mutation({query:e=>({url:"/products",method:"POST",body:e}),transformResponse:e=>({...e,price:String(e.price),image:e.image.startsWith("http")?e.image:"https://fakestoreapi.com".concat(e.image.startsWith("/")?"":"/").concat(e.image)}),invalidatesTags:[{type:"Product",id:"LIST"}]}),updateProduct:e.mutation({query:e=>({url:"/products/".concat(e.id),method:"PUT",body:{...e,price:Number(e.price)}}),transformResponse:e=>({...e,price:String(e.price),image:e.image.startsWith("http")?e.image:"https://fakestoreapi.com".concat(e.image.startsWith("/")?"":"/").concat(e.image)}),invalidatesTags:(e,t,a)=>[{type:"Product",id:a.id},{type:"Product",id:"LIST"}]}),deleteProduct:e.mutation({query:e=>({url:"/products/".concat(e),method:"DELETE"}),invalidatesTags:(e,t,a)=>[{type:"Product",id:a},{type:"Product",id:"LIST"}]})})}),{useGetProductsQuery:c,useGetProductByIdQuery:o,useAddProductMutation:l,useUpdateProductMutation:n,useDeleteProductMutation:d}=i},6915:e=>{e.exports={form:"ProductForm_form__4c_aR",formGroup:"ProductForm_formGroup__zTukF",label:"ProductForm_label__tHs3R",input:"ProductForm_input__ZQ4LX",textarea:"ProductForm_textarea__64n9A",select:"ProductForm_select__NCX4f",addCategoryButton:"ProductForm_addCategoryButton__XXAiQ",fileInputContainer:"ProductForm_fileInputContainer__WZIax",fileInputLabel:"ProductForm_fileInputLabel__01zld",fileInput:"ProductForm_fileInput__Gxgml",fileName:"ProductForm_fileName__qE2fq",filePlaceholder:"ProductForm_filePlaceholder__CyHVx",error:"ProductForm_error__aDKtY",submitButton:"ProductForm_submitButton__ozLob"}},9007:(e,t,a)=>{"use strict";a.d(t,{i:()=>n});var r=a(5155),s=a(2177),i=a(6915),c=a.n(i),o=a(1471),l=a(2115);function n(e){let{initialData:t,onSubmit:a,onCancel:i,isSubmitting:n,existingCategories:d,setExistingCategories:u,fileInputRef:m}=e,[p,g]=(0,l.useState)(""),[h,f]=(0,l.useState)(null),[y,x]=(0,l.useState)(!1),[P,_]=(0,l.useState)((null==t?void 0:t.image)||""),{data:N=[]}=(0,o.Kc)(),{register:j,handleSubmit:b,setValue:v,watch:C,formState:{errors:L,isValid:I},reset:S}=(0,s.mN)({mode:"onChange"});(0,l.useEffect)(()=>{t&&(S({title:t.title||"",price:t.price||"0",description:t.description||"",category:t.category||d[0]||"",newCategory:t.newCategory||""}),_(t.image||""))},[t,S,d]),(0,l.useEffect)(()=>{N.length>0&&0===d.length&&u(Array.from(new Set(N.map(e=>e.category))).filter(Boolean).sort())},[N,d,u]);let F=()=>{x(!y),y?d.length>0&&v("category",d[0]):v("category","")},T=!!t,q=!T||!P;return(0,r.jsxs)("form",{onSubmit:b(e=>{var t,r;a(e,(null==(r=m.current)||null==(t=r.files)?void 0:t[0])||null)}),className:c().form,children:[(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{className:c().label,children:"Название товара*"}),(0,r.jsx)("input",{className:c().input,...j("title",{required:"Название обязательно",minLength:{value:3,message:"Минимум 3 символа"},maxLength:{value:100,message:"Максимум 100 символов"}}),placeholder:"Введите название товара"}),L.title&&(0,r.jsx)("span",{className:c().error,children:L.title.message})]}),(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{className:c().label,children:"Описание*"}),(0,r.jsx)("textarea",{className:"".concat(c().input," ").concat(c().textarea),...j("description",{required:"Описание обязательно",minLength:{value:10,message:"Минимум 10 символов"},maxLength:{value:500,message:"Максимум 500 символов"}}),placeholder:"Введите описание товара",rows:4}),L.description&&(0,r.jsx)("span",{className:c().error,children:L.description.message})]}),(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{className:c().label,children:"Цена*"}),(0,r.jsx)("input",{type:"text",className:c().input,...j("price",{required:"Цена обязательна",pattern:{value:/^\d+(\.\d{1,2})?$/,message:"Формат: 19.99"},min:{value:.01,message:"Минимум 0.01"}}),placeholder:"Введите цену товара"}),L.price&&(0,r.jsx)("span",{className:c().error,children:L.price.message})]}),(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsx)("label",{className:c().label,children:"Категория*"}),y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{className:c().input,...j("newCategory",{required:"Новая категория обязательна",minLength:{value:2,message:"Минимум 2 символа"},maxLength:{value:30,message:"Максимум 30 символов"},validate:e=>!d.includes((null==e?void 0:e.trim())||"")||"Категория уже существует"}),placeholder:"Введите новую категорию"}),(0,r.jsx)("button",{type:"button",className:c().addCategoryButton,onClick:F,children:"← Выбрать из существующих"}),L.newCategory&&(0,r.jsx)("span",{className:c().error,children:L.newCategory.message})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("select",{className:c().input,...j("category",{required:"Категория обязательна"}),children:d.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)("button",{type:"button",className:c().addCategoryButton,onClick:F,children:"+ Создать новую категорию"})]})]}),(0,r.jsxs)("div",{className:c().formGroup,children:[(0,r.jsxs)("label",{className:c().label,children:["Изображение товара",q?"*":""]}),P&&(0,r.jsx)("div",{className:c().currentImage,children:(0,r.jsx)("img",{src:P,alt:"Текущее изображение",className:c().imagePreview})}),(0,r.jsxs)("div",{className:c().fileInputContainer,children:[(0,r.jsxs)("label",{className:c().fileInputLabel,children:["Выбрать файл",(0,r.jsx)("input",{type:"file",className:c().fileInput,onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(!a.type.startsWith("image/"))return void f("Пожалуйста, выберите файл изображения");if(a.size>5242880)return void f("Размер изображения не должен превышать 5MB");g(a.name),f(null),_(URL.createObjectURL(a))}},accept:"image/*",required:q,ref:m})]}),p?(0,r.jsx)("span",{className:c().fileName,children:p}):P?(0,r.jsx)("span",{className:c().fileName,children:"Текущее изображение"}):(0,r.jsx)("span",{className:c().filePlaceholder,children:"Файл не выбран"})]}),h&&(0,r.jsx)("span",{className:c().error,children:h})]}),(0,r.jsxs)("div",{className:c().formActions,children:[i&&(0,r.jsx)("button",{type:"button",className:c().cancelButton,onClick:i,disabled:n,children:"Отмена"}),(0,r.jsx)("button",{type:"submit",className:c().submitButton,disabled:n||!I,children:n?"Сохранение...":T?"Обновить":"Создать"})]})]})}}}]);