(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[513],{558:(t,e,a)=>{"use strict";a.d(e,{Ay:()=>i,Bj:()=>c,DD:()=>o,vc:()=>s});let r=(0,a(5710).Z0)({name:"products",initialState:{localProducts:[]},reducers:{addProduct:{reducer(t,e){t.localProducts.unshift(e.payload)},prepare(t){let e=Date.now();return{payload:{...t,id:e}}}},updateProduct(t,e){let a=t.localProducts.findIndex(t=>t.id===e.payload.id);-1!==a?t.localProducts[a]=e.payload:t.localProducts.unshift(e.payload)},deleteProduct(t,e){t.localProducts=t.localProducts.filter(t=>t.id!==e.payload)}},extraReducers:t=>{t.addMatcher(t=>t.type.includes("productsApi"),t=>t)}}),{addProduct:c,updateProduct:s,deleteProduct:o}=r.actions,i=r.reducer},1471:(t,e,a)=>{"use strict";a.d(e,{Kc:()=>o,ZN:()=>s,hi:()=>i});var r=a(404),c=a(4317);let s=(0,r.xP)({reducerPath:"productsApi",baseQuery:(0,c.cw)({baseUrl:"https://fakestoreapi.com/",prepareHeaders:t=>(t.set("Content-Type","application/json"),t)}),tagTypes:["Product"],endpoints:t=>({getProducts:t.query({query:()=>"/products",transformResponse:t=>t.map(t=>({...t,price:String(t.price),image:t.image.startsWith("http")?t.image:"https://fakestoreapi.com".concat(t.image.startsWith("/")?"":"/").concat(t.image),rating:t.rating||{rate:0,count:0}})),providesTags:t=>t?[...t.map(t=>{let{id:e}=t;return{type:"Product",id:e}}),{type:"Product",id:"LIST"}]:[{type:"Product",id:"LIST"}]}),getProductById:t.query({query:t=>"/products/".concat(t),transformResponse:t=>({...t,price:String(t.price),image:t.image.startsWith("http")?t.image:"https://fakestoreapi.com".concat(t.image.startsWith("/")?"":"/").concat(t.image),rating:t.rating||{rate:0,count:0}}),providesTags:(t,e,a)=>[{type:"Product",id:a}]}),addProduct:t.mutation({query:t=>({url:"/products",method:"POST",body:t}),transformResponse:t=>({...t,price:String(t.price),image:t.image.startsWith("http")?t.image:"https://fakestoreapi.com".concat(t.image.startsWith("/")?"":"/").concat(t.image)}),invalidatesTags:[{type:"Product",id:"LIST"}]}),updateProduct:t.mutation({query:t=>({url:"/products/".concat(t.id),method:"PUT",body:{...t,price:Number(t.price)}}),transformResponse:t=>({...t,price:String(t.price),image:t.image.startsWith("http")?t.image:"https://fakestoreapi.com".concat(t.image.startsWith("/")?"":"/").concat(t.image)}),invalidatesTags:(t,e,a)=>[{type:"Product",id:a.id},{type:"Product",id:"LIST"}]}),deleteProduct:t.mutation({query:t=>({url:"/products/".concat(t),method:"DELETE"}),invalidatesTags:(t,e,a)=>[{type:"Product",id:a},{type:"Product",id:"LIST"}]})})}),{useGetProductsQuery:o,useGetProductByIdQuery:i,useAddProductMutation:n,useUpdateProductMutation:d,useDeleteProductMutation:l}=s},2189:t=>{t.exports={card:"ProductCard_card__F5Ind",imageContainer:"ProductCard_imageContainer__6hAzS",productImage:"ProductCard_productImage__kliTS",content:"ProductCard_content__G_D8_",title:"ProductCard_title__wQgZ_",meta:"ProductCard_meta__JHZJb",price:"ProductCard_price__fd5N6",category:"ProductCard_category__ZehUx",rating:"ProductCard_rating__5D_8p",stars:"ProductCard_stars__fKUEx",cardDescription:"ProductCard_cardDescription__v2QKU",actions:"ProductCard_actions__FDxjT",favoriteButton:"ProductCard_favoriteButton__9VwZf",deleteButton:"ProductCard_deleteButton__kvX1L",active:"ProductCard_active__z55_U"}},3691:t=>{t.exports={container:"ProductsList_container__ibgnn",loading:"ProductsList_loading__m0AoZ",error:"ProductsList_error__s9t9n",controls:"ProductsList_controls__R9fne",filterButtons:"ProductsList_filterButtons__0e7f9",filterButton:"ProductsList_filterButton__1Lm4e",active:"ProductsList_active__96JxS",categoryDropdown:"ProductsList_categoryDropdown__p9Gn3",arrow:"ProductsList_arrow__gNtnA",categoryMenu:"ProductsList_categoryMenu__oIRCI",categoryButton:"ProductsList_categoryButton__Sb7Lo",selected:"ProductsList_selected__0fS_p",activeCategory:"ProductsList_activeCategory__cRV8t",clearCategory:"ProductsList_clearCategory__ZmMja",emptyState:"ProductsList_emptyState__lNXPA",productsGrid:"ProductsList_productsGrid__WbX6g",pagination:"ProductsList_pagination__ws_CK",pageButton:"ProductsList_pageButton__UcmJs",pageInfo:"ProductsList_pageInfo__wvMGq"}},6756:(t,e,a)=>{"use strict";a.d(e,{A:()=>s,d:()=>c});let r=(0,a(5710).Z0)({name:"favorites",initialState:{items:[]},reducers:{toggleFavorite:(t,e)=>{let a=t.items.indexOf(e.payload);a>=0?t.items.splice(a,1):t.items.push(e.payload)}}}),{toggleFavorite:c}=r.actions,s=r.reducer},9513:(t,e,a)=>{"use strict";a.d(e,{ProductsList:()=>f});var r=a(5155),c=a(1471),s=a(2189),o=a.n(s),i=a(5695),n=a(6766),d=a(2115);function l(t){let{product:e,isFavorite:a,onToggleFavorite:c,onDelete:s,onEdit:l}=t,u=(0,i.useRouter)(),[p,m]=(0,d.useState)(!1),[g,_]=(0,d.useState)(a),[h,f]=(0,d.useState)(()=>{var t,r;return{rate:(null==(t=e.rating)?void 0:t.rate)||0,count:((null==(r=e.rating)?void 0:r.count)||0)+ +!!a}}),P=(0,d.useCallback)(t=>{t.stopPropagation();let a=!g;f(t=>({...t,count:a?t.count+1:Math.max(0,t.count-1)})),_(a),c(e.id)},[g,c,e.id]),v=(0,d.useCallback)(()=>{try{let t="string"==typeof e.price?parseFloat(e.price.replace(/[^\d.]/g,"")):Number(e.price);return isNaN(t)?"$".concat(e.price):new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}catch(t){return"$".concat(e.price)}},[e.price]),y=(0,d.useCallback)(()=>{sessionStorage.setItem("product_".concat(e.id),JSON.stringify(e)),u.push("/products/".concat(e.id))},[e,u]),x=(0,d.useCallback)((t,e)=>{t.stopPropagation(),e()},[]),N=(0,d.useCallback)(()=>{let t=Math.floor(h.rate),e=h.rate%1>=.5;return(0,r.jsxs)(r.Fragment,{children:["★".repeat(t),e&&"\xbd","☆".repeat(5-t-!!e)]})},[h.rate]);return(0,r.jsxs)("article",{className:o().card,onClick:y,"aria-labelledby":"product-title-".concat(e.id),"data-testid":"product-card",children:[(0,r.jsx)("div",{className:o().imageContainer,children:e.image&&!p?(0,r.jsx)(n.default,{src:e.image,alt:e.title,className:o().productImage,width:200,height:200,onError:()=>m(!0),priority:!1,unoptimized:!0}):(0,r.jsx)("div",{className:o().imagePlaceholder,children:(0,r.jsx)("span",{children:"No Image Available"})})}),(0,r.jsxs)("div",{className:o().content,children:[(0,r.jsx)("h3",{id:"product-title-".concat(e.id),className:o().title,title:e.title,children:e.title}),(0,r.jsxs)("div",{className:o().meta,children:[(0,r.jsx)("span",{className:o().price,children:v()}),e.category&&(0,r.jsx)("span",{className:o().category,title:e.category,children:e.category})]}),(0,r.jsxs)("div",{className:o().rating,"aria-label":"Rating: ".concat(h.rate," out of 5"),children:[(0,r.jsx)("span",{className:o().stars,children:N()}),(0,r.jsxs)("span",{className:o().reviews,children:["(",h.count,")"]})]}),e.description&&(0,r.jsx)("p",{className:o().description,children:e.description.length>100?"".concat(e.description.substring(0,97),"..."):e.description}),(0,r.jsxs)("div",{className:o().actions,children:[(0,r.jsx)("button",{onClick:P,className:"".concat(o().actionButton," ").concat(g?o().favoriteActive:""),"aria-label":g?"Remove from favorites":"Add to favorites",children:g?"❤️":"\uD83E\uDD0D"}),l&&(0,r.jsx)("button",{onClick:t=>x(t,()=>l(e.id)),className:o().actionButton,"aria-label":"Edit ".concat(e.title),children:"✏️"}),s&&(0,r.jsx)("button",{onClick:t=>x(t,()=>s(e.id)),className:o().actionButton,"aria-label":"Delete ".concat(e.title),children:"\uD83D\uDDD1️"})]})]})]})}var u=a(4540),p=a(6756);let m=()=>(0,u.wA)();var g=a(3691),_=a.n(g),h=a(558);function f(){let[t,e]=(0,d.useState)("all"),[a,s]=(0,d.useState)(null),[o,n]=(0,d.useState)(1),[g,f]=(0,d.useState)(!1),[P,v]=(0,d.useState)([]),y=(0,d.useRef)(null);(0,d.useEffect)(()=>{let t=localStorage.getItem("deletedServerIds");t&&v(JSON.parse(t))},[]);let{data:x=[],isLoading:N,isError:C}=(0,c.Kc)(),j=(0,u.d4)(t=>t.products.localProducts),b=(0,u.d4)(t=>t.favorites.items),S=m(),L=(0,i.useRouter)(),k=(0,d.useMemo)(()=>{let t=[...j];return x.forEach(e=>{P.includes(e.id)||t.some(t=>t.id===e.id)||t.push(e)}),t},[j,x,P]),w=(0,d.useMemo)(()=>Array.from(new Set(k.map(t=>t.category))).filter(t=>null!=t).sort(),[k]),B=(0,d.useMemo)(()=>{let e=[...k];return"favorites"===t?e=e.filter(t=>b.includes(t.id)):"categories"===t&&a&&(e=e.filter(t=>t.category===a)),e},[k,b,t,a]),D=(o-1)*9,I=B.slice(D,D+9),T=Math.ceil(B.length/9);(0,d.useEffect)(()=>{let t=t=>{y.current&&!y.current.contains(t.target)&&f(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);let E=t=>{s(e=>e===t?null:t),e("categories"),n(1),f(!1)},M=(0,d.useCallback)(t=>{if(window.confirm("Вы уверены, что хотите удалить этот товар?")){if(t>=1e3)S((0,h.DD)(t));else{let e=[...P,t];v(e),localStorage.setItem("deletedServerIds",JSON.stringify(e))}L.push("/products?refresh=".concat(Date.now()))}},[S,L,P]),A=t=>{L.push("/products/edit/".concat(t))},R=(0,d.useCallback)(t=>{S((0,p.d)(t))},[S]),F=(0,d.useCallback)(t=>{e(t),s(null),n(1),f(!1)},[]);return N?(0,r.jsx)("div",{className:_().loading,children:"Загрузка товаров..."}):C?(0,r.jsx)("div",{className:_().error,children:"Ошибка загрузки данных"}):(0,r.jsxs)("div",{className:_().container,children:[(0,r.jsxs)("div",{className:_().controls,children:[(0,r.jsxs)("div",{className:_().filterButtons,children:[(0,r.jsx)("button",{className:"".concat(_().filterButton," ").concat("all"===t&&_().active),onClick:()=>F("all"),children:"Все товары"}),(0,r.jsxs)("div",{className:_().categoryDropdown,ref:y,children:[(0,r.jsxs)("button",{className:"".concat(_().filterButton," ").concat("categories"===t&&_().active),onClick:t=>{t.preventDefault(),t.stopPropagation(),f(t=>!t)},"aria-expanded":g,children:["Категории",(0,r.jsx)("span",{className:_().arrow,children:g?"▲":"▼"})]}),g&&(0,r.jsx)("div",{className:_().categoryMenu,children:w.map(t=>(0,r.jsx)("button",{className:"".concat(_().categoryButton," ").concat(a===t&&_().selected),onClick:()=>E(t),children:t},t))})]}),(0,r.jsxs)("button",{className:"".concat(_().filterButton," ").concat("favorites"===t&&_().active),onClick:()=>F("favorites"),children:["Избранное (",b.length,")"]})]}),a&&(0,r.jsxs)("div",{className:_().activeCategory,children:[(0,r.jsx)("span",{children:a}),(0,r.jsx)("button",{onClick:()=>s(null),className:_().clearCategory,children:"\xd7"})]})]}),0===B.length?(0,r.jsx)("div",{className:_().emptyState,children:"favorites"===t?"В избранном пока нет товаров":"Товары не найдены. Попробуйте изменить критерии поиска."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:_().productsGrid,children:I.map(t=>(0,r.jsx)(l,{product:t,isFavorite:b.includes(t.id),onToggleFavorite:R,onDelete:()=>M(t.id),onEdit:()=>A(t.id)},"product-".concat(t.id)))}),T>1&&(0,r.jsxs)("div",{className:_().pagination,children:[(0,r.jsx)("button",{onClick:()=>n(t=>Math.max(1,t-1)),disabled:1===o,className:_().pageButton,children:"← Назад"}),(0,r.jsxs)("span",{className:_().pageInfo,children:["Страница ",o," из ",T]}),(0,r.jsx)("button",{onClick:()=>n(t=>Math.min(T,t+1)),disabled:o===T,className:_().pageButton,children:"Вперед →"})]})]})]})}}}]);